<div class="card col-md-5 mx-auto">
  <div class="card-body text-center">
    <h2>Bài kiểm tra: <%= @task.test_title %></h2>
    <p class="text-mute">Mô tả: <%= @task.test_description %></p>
    <p>Thời gian mở đề: <%= @task.test_start_time.strftime(Settings.test.show_datetime) %></p>
    <p>Hạn nộp bài: <%= @task.test_due_time.strftime(Settings.test.show_datetime) %></p>
    <p>Thời gian làm:
      <% if @task.test_unlimited_flag %>
        <span class="text-primary">Không giới hạn thời gian</span>
      <% else %>
        <%= @task.test_doing_time %> phút
      <% end %>
    </p>
    <div class="form-group d-none link-open-task">
      <%= link_to "Bắt đầu", edit_students_task_path(id: @task.id),
        class: "btn btn-round btn-success start-doing-task" %>
    </div>
  </div>
</div>
<script>
  var timeInterval = checkTimeDoingTask();
  $(function() {
    timeInterval;
  })

  function checkTimeDoingTask() {
    i = setInterval(() => {
      canDoingTask()
    }, 1000);
    return i;
  }

  function stopCheckTimeDoingTask() {
    clearInterval(timeInterval);
  }

  function canDoingTask() {
    <% if Time.zone.now() >= @task.test_start_time && @task.unsubmitted? %>
      $('.link-open-task').removeClass('d-none');
    <% elsif @task.submitted? || @task.expired? %>
      $('.link-open-task').html('');
      stopCheckTimeDoingTask();
    <% end %>
  }

  $('.start-doing-task').on('click', function(){
    stopCheckTimeDoingTask();
  })
</script>
